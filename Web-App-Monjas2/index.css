/************************************
 * A) Ocultaci√≥n UI nativa ModelViewer
 *************************************/
model-viewer::part(ar-button) {
  display: none !important;
}

model-viewer::part(ar-prompt) {
  display: none !important;
}

model-viewer::part(ar-status) {
  display: none !important;
}

/* Fallback si existe elemento con slot="ar-button" */
model-viewer button[slot="ar-button"] {
  display: none !important;
}


/******************************
  * B) Variables y posicionamiento FAB
  ******************************/
:root {
  /* margen inferior base en pantallas normales */
  --fab-bottom: calc(clamp(16px, 5vh, 90px) + env(safe-area-inset-bottom));
}

/* el bot√≥n AR usa siempre esta variable */
.ar-fab {
  bottom: var(--fab-bottom);
}

/* En SPLAT, subimos los botones */
body.mode-splat {
  --fab-bottom: calc(70px + env(safe-area-inset-bottom));
}

/* m√≥viles muy estrechos: un poco m√°s alto */
@media (max-width: 420px) {
  body.mode-splat {
    --fab-bottom: calc(70px + env(safe-area-inset-bottom));
  }
}

/* pantallas bajitas en horizontal */
@media (max-height: 480px) {
  body.mode-splat {
    --fab-bottom: calc(100px + env(safe-area-inset-bottom));
  }
}


/******************************
  * C) Fila y posici√≥n de FABs
  ******************************/
/* AR a la derecha */
.ar-fab {
  position: fixed;
  right: 18px;
  bottom: var(--fab-bottom);
  left: auto;
  transform: none;
}

/* Fila de FABs (evita solapamientos) */
.fab-row {
  position: fixed;
  left: 0;
  right: 0;
  bottom: var(--fab-bottom);
  display: none;
  /* solo m√≥vil/tablet */
  align-items: center;
  justify-content: space-between;
  /* audio izq, AR dcha */
  padding: 0 18px;
  z-index: 20;
  pointer-events: none;
  /* la fila no intercepta, los botones s√≠ */
}

/* Los botones dentro de la fila dejan de ser "fixed" */
.fab-row .ar-fab,
.fab-row .audio-fab {
  position: relative;
  left: auto;
  right: auto;
  bottom: auto;
  transform: none;
  pointer-events: auto;
  /* clics habilitados */
}

/* Mostrar en m√≥vil/tablet */
@media (max-width: 1024px) {
  .fab-row {
    display: flex;
  }
}

/******************************
  * D) Cartela inferior (info-sheet)
  ******************************/
.info-sheet {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  transform: translateY(100%);
  background: rgba(14, 16, 20, 0.75);
  backdrop-filter: blur(18px) saturate(140%);
  -webkit-backdrop-filter: blur(18px) saturate(140%);
  color: var(--text);
  border-top-left-radius: 18px;
  border-top-right-radius: 18px;
  box-shadow: 0 -10px 30px rgba(0, 0, 0, .45);
  padding-bottom: calc(18px + env(safe-area-inset-bottom));
  z-index: 1201;
  /* por encima del #topBar (1000) */
  transition: transform .28s ease, opacity .28s ease;
  opacity: 0;
  will-change: transform, opacity;
  touch-action: none;
  /* Evita scroll del fondo */
}

.info-sheet:not(.hidden) {
  transform: translateY(0%);
  opacity: 1;
}

.info-sheet__drag {
  width: 44px;
  height: 5px;
  border-radius: 999px;
  background: rgba(255, 255, 255, .18);
  margin: 10px auto 6px;
}

.info-sheet__close {
  position: absolute;
  right: 12px;
  top: 10px;
  width: 36px;
  height: 36px;
  border: none;
  border-radius: 10px;
  background: rgba(255, 255, 255, .08);
  color: #fff;
  font-size: 18px;
  cursor: pointer;
}

.info-sheet__content {
  padding: 10px 18px 0 18px;
}

#infoTitle {
  margin: 4px 0 6px;
  font-size: clamp(18px, 4.6vw, 24px);
  font-weight: 800;
}

.info-meta {
  margin: 0 0 10px;
  color: var(--muted);
  font-size: clamp(12px, 3.5vw, 14px);
}

.info-desc {
  margin: 0 0 10px;
  line-height: 1.5;
  font-size: clamp(14px, 3.8vw, 16px);
}

.info-extra {
  margin-top: 12px;
  color: var(--muted);
  font-size: 13px;
  line-height: 1.4;
}

.info-extra strong {
  color: var(--text);
  font-weight: 600;
}

/* Texto m√°s grande en la cartela */
#infoSheet .info-sheet__content,
#infoSheet .info-desc,
#infoSheet .info-meta,
#infoSheet .info-extra {
  font-size: 16px !important;
  line-height: 1.55 !important;
}


/******************************
  * E) Topbar (t√≠tulo + bot√≥n info)
  ******************************/
#topBar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 88px;
  background: rgba(15, 17, 21, 0.65);
  backdrop-filter: blur(12px) saturate(140%);
  -webkit-backdrop-filter: blur(12px) saturate(140%);
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  display: flex;
  align-items: center;
  justify-content: center;
  /* centramos el logo */
  position: relative;
  z-index: 40;
}

/* Bot√≥n Home (casita redonda) */
.home-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  border-radius: 999px;
  margin-right: 10px;
  color: #fff;
  background: rgba(255, 255, 255, .10);
  border: 1px solid rgba(255, 255, 255, .18);
  box-shadow: 0 8px 22px rgba(0, 0, 0, .25), inset 0 1px 4px rgba(255, 255, 255, .12);
  backdrop-filter: blur(10px) saturate(140%);
  -webkit-backdrop-filter: blur(10px) saturate(140%);
  text-decoration: none;
  transition: transform .12s ease, background .2s ease, box-shadow .25s ease;
  flex: 0 0 auto;
  /* no crecer */
}

.home-btn svg {
  width: 18px;
  height: 18px;
}

.home-btn:hover {
  background: rgba(255, 255, 255, .16);
}

.home-btn:active {
  transform: scale(.97);
}

/* Accesible (screen-readers) */
.sr-only {
  position: absolute !important;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

#topBar h1 {
  font-size: 18px;
  font-weight: 700;
  margin: 0;
  line-height: 1;
  display: flex;
  align-items: center;
}

#topBar * {
  pointer-events: auto;
}

#topBar.hidden {
  opacity: 0;
}

#topBar:not(.hidden) {
  opacity: 1;
}

/* Bot√≥n Info */
.info-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 120px;
  height: 36px;
  padding: 0 14px;
  box-sizing: border-box;
  border: 2px solid var(--brand);
  border-radius: 12px;
  background: rgba(64, 203, 203, .10);
  color: var(--brand);
  font-weight: 700;
  font-size: 14px;
  line-height: 1;
  letter-spacing: .2px;
  cursor: pointer;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  box-shadow: var(--shadow);
  transition: all .25s ease;
}

.info-btn:hover {
  background: rgba(64, 203, 203, .16);
}

.info-btn:active {
  transform: translateY(1px);
}

.info-btn:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px rgba(64, 203, 203, .35);
}

@media (max-width: 480px) {
  .info-btn {
    min-width: 108px;
    height: 34px;
    font-size: 13px;
  }
}

/* Ocultar UI al entrar en AR si hace falta */
body.in-ar #topBar,
body.in-ar .fab-row,
body.in-ar .ar-fab,
body.in-ar .audio-fab,
body.in-ar .info-sheet {
  display: none !important;
}

/* Fix header mobile: que el bot√≥n ‚ìò no se ‚Äúaplaste‚Äù */
#topBar {
  z-index: 1000;
  padding-top: env(safe-area-inset-top);
}

/* Tipograf√≠a personalizada para t√≠tulos de obras */
#pieceTitle {
  font-family: 'Poppins', serif;
  font-weight: 600;
  letter-spacing: 0;
  font-size: 18px;
  color: var(--text);
  margin: 0;
  text-shadow: 0 2px 6px rgba(0, 0, 0, .4);
}

@media (min-width: 768px) {
  #pieceTitle {
    font-size: 20px;
    -webkit-line-clamp: 1;
  }
}

/* --- Alineaci√≥n correcta del t√≠tulo dentro del topbar --- */
.left-group {
  display: flex;
  align-items: center;
  gap: 10px;
}

.title-wrapper {
  flex: 1;
  display: flex;
  align-items: center;
  min-width: 0;
  /* permite truncar texto */
}

#pieceTitle {
  font-family: 'Poppins', serif;
  font-weight: 600;
  font-size: 18px;
  color: var(--text);
  margin: 0;
  text-shadow: 0 2px 6px rgba(0, 0, 0, .4);
  line-height: 1.2;
  text-transform: none;
  /* respeta may/min */
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  /* m√°ximo dos l√≠neas */
  -webkit-box-orient: vertical;
  word-break: break-word;
}

/******************************
  * F) Safe areas globales
  ******************************/
html,
body {
  height: 100%;
  min-height: 100%;
  padding-bottom: env(safe-area-inset-bottom);
}

/******************************
  * G) Bot√≥n Audio (glass rojo)
  ******************************/
.audio-fab {
  height: 56px;
  width: 120px;
  border-radius: 18px;
  background:
    radial-gradient(circle at 30% 30%, rgba(255, 80, 80, .55), rgba(150, 0, 0, .45)),
    linear-gradient(135deg, rgba(255, 0, 0, .55), rgba(90, 0, 0, .42));
  border: 1px solid rgba(255, 0, 0, .7);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(14px) saturate(200%);
  -webkit-backdrop-filter: blur(14px) saturate(200%);
  box-shadow:
    0 0 12px rgba(255, 0, 0, .45),
    0 6px 22px rgba(255, 0, 0, .30),
    inset 0 2px 6px rgba(255, 255, 255, .18);
  transition: transform .12s ease, box-shadow .25s ease, background .25s ease, border-color .25s ease;
}

.audio-fab:active {
  transform: scale(.97);
}

.audio-fab.is-playing {
  background:
    radial-gradient(circle at 30% 30%, rgba(255, 100, 100, .66), rgba(200, 0, 0, .48)),
    linear-gradient(135deg, rgba(255, 20, 20, .70), rgba(140, 0, 0, .50));
  border-color: rgba(255, 40, 40, .9);
  box-shadow:
    0 0 18px rgba(255, 30, 30, .65),
    0 12px 28px rgba(255, 0, 0, .40),
    inset 0 2px 8px rgba(255, 255, 255, .22);
  animation: pulse-glow 1.8s ease-in-out infinite;
}

.audio-fab .icon-pause {
  display: none;
  width: 24px;
  height: 24px;
}

.audio-fab .icon-play {
  display: block;
  width: 24px;
  height: 24px;
}

.audio-fab.is-playing .icon-play {
  display: none;
}

.audio-fab.is-playing .icon-pause {
  display: block;
}

@keyframes pulse-glow {

  0%,
  100% {
    box-shadow: 0 0 14px rgba(255, 30, 30, .45);
  }

  50% {
    box-shadow: 0 0 22px rgba(255, 50, 50, .75);
  }
}

/******************************
  * J) Overlay "Abriendo AR‚Ä¶"
  ******************************/
.ar-loading {
  position: fixed;
  inset: 0;
  z-index: 9999;
  /* Por encima de TODO */
  display: flex !important;
  /* Forzar display flex siempre */
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 16px;
  background: rgba(10, 12, 16, .85);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  opacity: 0;
  visibility: hidden;
  /* Usar visibility en lugar de display:none */
  pointer-events: none;
  transition: opacity .2s ease, visibility .2s ease;
}

.ar-loading.visible {
  opacity: 1;
  visibility: visible;
  /* Hacer visible */
  pointer-events: auto;
}

/* Asegurar que el overlay NUNCA tenga display:none */
.ar-loading.hidden {
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  /* NO usar display:none aqu√≠ */
}

.ar-loading .spinner {
  width: 48px;
  height: 48px;
  border: 4px solid rgba(13, 217, 253, 0.25);
  border-top-color: rgba(13, 217, 253, 0.95);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  box-shadow: 0 0 20px rgba(13, 217, 253, 0.4);
}

.ar-loading span {
  color: var(--text);
  font: 600 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  letter-spacing: .3px;
  text-align: center;
  max-width: 280px;
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
}


/******************************
  * K) Accesibilidad e interacci√≥n (zoom, focus)
  ******************************/
#topBar,
#infoSheet,
.fab-row,
.info-btn,
.audio-fab,
.ar-fab {
  touch-action: manipulation;
  /* evita doble-tap zoom */
  -ms-touch-action: manipulation;
}

/* En iOS ayuda a que no ‚Äúsalte‚Äù el zoom por gesto en la UI */
#topBar *,
#infoSheet *,
.fab-row * {
  touch-action: manipulation;
}

/* Focus visible */
:focus-visible {
  outline: 2px solid #40cbcb;
  outline-offset: 3px;
}

.info-sheet__close:focus-visible,
.info-btn:focus-visible,
.audio-fab:focus-visible,
.ar-fab:focus-visible {
  box-shadow: 0 0 0 3px rgba(64, 203, 203, .35);
}


/******************************
  * L) Pantalla de carga (skeleton + %)
  ******************************/
.skeleton {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #15161B;
  color: #FFFFFF;
  font-family: 'Poppins', sans-serif;
  z-index: 9999;
  flex-direction: column;
  text-align: center;
  transition: opacity .6s ease;
}

.skeleton.hidden {
  opacity: 0;
  pointer-events: none;
}

.loader-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.loader-circle {
  width: 90px;
  height: 90px;
  border: 4px solid rgba(48, 134, 135, 0.25);
  border-top: 4px solid #308687;
  border-radius: 50%;
  animation: spin 1.2s linear infinite;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 20px;
  box-shadow: 0 0 10px rgba(48, 134, 135, 0.35);
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

#loaderProgress {
  position: absolute;
  font-size: 18px;
  font-weight: 600;
  color: #FFFFFF;
  text-shadow: 0 0 6px rgba(48, 134, 135, 0.4);
}

.loader-text {
  font-size: 14px;
  color: #FFFFFF;
  opacity: .85;
  line-height: 1.5;
  margin-top: 10px;
  font-weight: 400;
  max-width: 80%;
}

/* === Corregir rotaci√≥n del loader: el texto no gira === */
.loader-progress {
  position: absolute;
  transform: rotate(-1 * var(--spin-angle, 0deg));
  font-weight: 600;
  font-family: system-ui, sans-serif;
  color: #fff;
}

.info-desc,
.info-details,
.info-meta {
  font-family: 'Lora', Georgia, serif;
}

/******************************
  * M) Bot√≥n AR (glass azul) ‚Äì base y estados
  ******************************/
/* Base (tama√±o/caja + look) */
.ar-fab {
  /* tama√±o y caja */
  height: 56px;
  /* ‚Äúgrosor‚Äù de la pastilla */
  min-width: 180px;
  padding: 0 18px;
  border-radius: 18px;
  display: flex;
  align-items: center;
  justify-content: center;

  /* look azul final */
  background:
    radial-gradient(circle at 30% 30%, rgba(13, 217, 253, 0.88), rgba(2, 199, 199, 0.62)),
    linear-gradient(135deg, rgba(13, 110, 253, 0.88), rgba(0, 42, 120, 0.62));
  border: 1px solid rgba(101, 255, 247, 0.98);
  color: #fff;
  gap: 10px;
  font-size: 16px;
  font-weight: 700;
  letter-spacing: .2px;
  backdrop-filter: blur(14px) saturate(200%);
  -webkit-backdrop-filter: blur(14px) saturate(200%);
  box-shadow:
    0 0 12px rgba(13, 110, 253, 0.55),
    0 8px 24px rgba(13, 110, 253, 0.40),
    inset 0 2px 8px rgba(255, 255, 255, 0.18);
  transition: background .25s ease, box-shadow .25s ease, transform .12s ease;
}

/* Estado activo / glow */
.ar-fab.is-active {
  background:
    radial-gradient(circle at 30% 30%, rgba(0, 140, 255, 0.95), rgba(0, 70, 170, 0.78)),
    linear-gradient(135deg, rgba(0, 140, 255, 0.95), rgba(0, 70, 170, 0.78));
  border-color: rgba(0, 140, 255, 1);
  box-shadow:
    0 0 18px rgba(0, 140, 255, 0.78),
    0 12px 28px rgba(0, 100, 210, 0.48),
    inset 0 2px 10px rgba(255, 255, 255, 0.22);
  animation: pulse-glow-ar 1.8s ease-in-out infinite;
}

/* Estado loading (preparando AR) */
.ar-fab.is-loading {
  background:
    radial-gradient(circle at 30% 30%, rgba(255, 165, 0, 0.85), rgba(255, 140, 0, 0.65)),
    linear-gradient(135deg, rgba(255, 165, 0, 0.85), rgba(200, 100, 0, 0.65));
  border-color: rgba(255, 180, 50, 0.95);
  box-shadow:
    0 0 16px rgba(255, 165, 0, 0.65),
    0 10px 26px rgba(255, 140, 0, 0.45),
    inset 0 2px 8px rgba(255, 255, 255, 0.20);
  cursor: wait;
  pointer-events: none;
}

/* Estado disabled (modelo no cargado) */
.ar-fab.is-disabled,
.ar-fab:disabled {
  background:
    radial-gradient(circle at 30% 30%, rgba(100, 100, 100, 0.45), rgba(60, 60, 60, 0.35)),
    linear-gradient(135deg, rgba(80, 80, 80, 0.45), rgba(50, 50, 50, 0.35));
  border-color: rgba(120, 120, 120, 0.50);
  color: rgba(255, 255, 255, 0.40);
  box-shadow:
    0 0 6px rgba(100, 100, 100, 0.25),
    0 4px 12px rgba(80, 80, 80, 0.20),
    inset 0 1px 4px rgba(255, 255, 255, 0.08);
  cursor: not-allowed;
  pointer-events: none;
  opacity: 0.6;
}

/* Interacci√≥n */
.ar-fab:active:not(.is-loading):not(.is-disabled):not(:disabled) {
  transform: scale(0.97);
}

/* Si el inline del <head> centra el bot√≥n con translateX(-50%), conserva el centrado en :active */
.ar-fab[style*="translateX(-50%)"]:active:not(.is-loading):not(.is-disabled):not(:disabled) {
  transform: translateX(-50%) scale(0.97);
}

/* Animaci√≥n de pulso al tocar */
.ar-fab.tap-pulse {
  animation: tap-pulse-effect 0.3s ease-out;
}

@keyframes tap-pulse-effect {
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(1.05);
  }

  100% {
    transform: scale(1);
  }
}

@keyframes pulse-glow-ar {

  0%,
  100% {
    box-shadow: 0 0 14px rgba(48, 134, 135, 0.45);
  }

  50% {
    box-shadow: 0 0 22px rgba(48, 134, 135, 0.75);
  }
}


/******************************
  * N) Detalles AR FAB (icono, gap, breakpoints)
  ******************************/
.ar-fab>svg {
  width: 22px;
  height: 22px;
  flex: 0 0 auto;
  /* evita que crezca por el layout */
}

.ar-fab {
  gap: 8px;
}

/* Ocultar icono AR cuando est√° cargando, mostrar spinner */
.ar-fab.is-loading .ar-icon {
  display: none;
}

.ar-fab.is-loading .ar-spinner {
  display: block !important;
}

/* separa un poco menos icono/texto */
@media (max-width: 420px) {
  .ar-fab>svg {
    width: 20px;
    height: 20px;
  }
}


/* ====== Variables base de tema (sin tocar --fab-bottom) ====== */
:root {
  --bg: #0f1115;
  --text: #e9eef7;
  --muted: #9aa4b2;
  --brand: #40cbcb;
  --shadow: 0 10px 30px rgba(0, 0, 0, .35);
}

/* ====== Reseteo base del documento ====== */
html,
body {
  margin: 0;
  height: 100%;
  color: var(--text);
  overflow: hidden;
  /* la escena ocupa toda la pantalla */
}

/* Evitar scroll en m√≥viles y arrastre accidental de p√°gina */
html,
body {
  touch-action: none;
  /* bloquea gestures tipo scroll/pinch */
  overscroll-behavior: none;
  /* evita rebote de scroll */
}

/* Utilidades */
.full {
  position: fixed;
  inset: 0;
}

.hidden {
  display: none !important;
}

/* ====== Viewports de las escenas ====== */
model-viewer {
  width: 100vw;
  height: 100dvh;
  display: block;
  background: transparent !important;
  /* el lienzo deja ver el degradado del body */
}

iframe#splat {
  width: 100vw;
  height: 100dvh;
  display: block;
  background: var(--bg);
  /* el SPLAT s√≠ usa fondo s√≥lido */
  border: 0;
}

/* === SPLAT poster dentro del marco === */
#viewerContainer {
  position: relative;
  overflow: hidden;
}

#splatPoster {
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  z-index: 2;
  /* encima del iframe */
  transition: opacity 0.9s ease, filter 0.9s ease, transform 0.9s ease;
}

#splatPoster.fade-out {
  opacity: 0;
  filter: blur(14px) brightness(0.8);
  transform: scale(1.03);
}

/* Asegurar que el iframe del SPLAT queda debajo */
iframe#splat {
  position: relative;
  z-index: 1;
  width: 100%;
  height: 100%;
  border: none;
  display: block;
}

/* ====== Mensaje de ayuda/error ====== */
#msg {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font: 500 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  text-align: center;
  color: var(--muted);
  padding: 24px;
}

#msg b {
  color: #ff6464;
}

/* === Soft reveal de escenas (fade-in al cargar) === */
model-viewer,
iframe#splat {
  flex: 0 0 calc(70% - 20px);
  border-radius: 0px;
  overflow: hidden;
}

model-viewer.is-visible,
iframe#splat.is-visible {
  opacity: 1;
  /* visible cuando la escena est√° lista */
}

/* ====== Spinner visual para el overlay AR ====== */
.ar-loading .spinner {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: 3px solid rgba(255, 255, 255, .22);
  border-top-color: #fff;
  animation: spin .9s linear infinite;
}

/* === Estado deshabilitado del bot√≥n de audio === */
.audio-fab[disabled] {
  opacity: 0.45;
  cursor: not-allowed;
  pointer-events: none;
  filter: grayscale(70%);
  transition: opacity 0.25s ease, filter 0.25s ease;
}

.audio-fab[disabled] svg {
  opacity: 0.6;
}

.audio-fab[disabled]::after {
  content: "Audio no disponible";
  position: absolute;
  bottom: -1.8em;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.75rem;
  color: #ccc;
  opacity: 0.8;
  white-space: nowrap;
}

/* AR deshabilitado mientras no carga el modelo */
.ar-fab[disabled],
.ar-fab.is-disabled {
  opacity: 0.5;
  cursor: not-allowed;
  filter: grayscale(30%);
  pointer-events: none;
}

/* === FAB row: separaci√≥n y safe area === */
.fab-row {
  gap: 12px;
  padding: 0 18px calc(env(safe-area-inset-bottom) + 0px);
}

@media (max-width: 420px) {
  .fab-row {
    gap: 10px;
    padding: 0 14px calc(env(safe-area-inset-bottom) + 0px);
  }
}

/* === Cartela: scroll interno + bloqueo de scroll de fondo === */
body.sheet-open {
  overflow: hidden;
}

.info-sheet {
  max-height: min(78vh, 640px);
}

.info-sheet__content {
  max-height: calc(min(78vh, 640px) - 54px);
  /* 54px ‚âà drag + paddings */
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

/* === Accesibilidad: reducir movimientos si el usuario lo pide === */
@media (prefers-reduced-motion: reduce) {

  .skeleton,
  .ar-loading,
  .info-sheet {
    transition: none !important;
    animation: none !important;
  }
}

/* === FIX loader: que gire solo el aro y no el n√∫mero === */
/* Deja el contenedor fijo (sin animaci√≥n) */
.loader-circle {
  position: relative;
  /* mantenemos tama√±o y centrado existentes */
  width: 90px;
  height: 90px;
  border: none !important;
  /* quitamos el borde del contenedor */
  box-shadow: none !important;
  /* lo movemos al ::before */
  animation: none !important;
  /* el contenedor YA NO rota */
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 20px;
  /* conservado de tu regla original */
}

/* Dibujamos y rotamos el aro en un pseudo-elemento */
.loader-circle::before {
  content: "";
  position: absolute;
  inset: 0;
  /* ocupa todo el c√≠rculo */
  border-radius: 50%;
  border: 4px solid rgba(48, 134, 135, 0.25);
  border-top-color: #308687;
  /* ‚Äúsector‚Äù que se ve girar */
  box-shadow: 0 0 10px rgba(48, 134, 135, 0.35);
  animation: spin 1.2s linear infinite;
  /* reutiliza tu @keyframes spin */
}

/* Centra el porcentaje y NO lo rota */
#loaderProgress {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  /* solo centrar, sin rotaci√≥n */
  font-size: 18px;
  font-weight: 600;
  color: #FFFFFF;
  text-shadow: 0 0 6px rgba(48, 134, 135, 0.4);
}

/* === Toast m√≠nimo (para avisos como "toca para habilitar audio") === */
.toast {
  position: fixed;
  left: 50%;
  bottom: calc(var(--fab-bottom) + 72px);
  transform: translateX(-50%);
  background: rgba(20, 24, 30, 0.9);
  color: #e9eef7;
  padding: 10px 14px;
  border-radius: 12px;
  font: 600 13px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 1200;
  opacity: 0;
  pointer-events: none;
  transition: opacity .25s ease, transform .25s ease;
}

.toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(-4px);
}

/* Fallback visual al tocar (para iOS/desktop sin vibraci√≥n) */
.tap-pulse {
  transform: scale(0.98);
  transition: transform 120ms ease;
}

/* Deja el host visible (el p√≥ster vive aqu√≠) */
model-viewer {
  opacity: 1;
  transition: opacity .35s ease;
  background: transparent !important;
}

/* El body puede tener un color mientras carga, pero no debe tapar al skybox del <model-viewer> */
body {
  /* Fondo degradado suave y moderno */
  background: radial-gradient(circle at 80% 0%, #2b1a10, #140d08 50%, #0b0e14 90%),
    linear-gradient(180deg, #19120b 0%, #0f1115 100%);

  background-attachment: fixed;
  background-size: cover;
  background-repeat: no-repeat;
}

model-viewer {
  background: transparent !important;
}

/* =========================================================
   üíª DESKTOP LAYOUT (‚â•1024px)
   Estructura limpia y unificada
   ========================================================= */
@media (min-width: 1024px) {

  /* --- TOPBAR (solo escritorio) --- */
  #topBar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 88px;
    background: rgba(15, 17, 21, 0.65);
    backdrop-filter: blur(12px) saturate(140%);
    -webkit-backdrop-filter: blur(12px) saturate(140%);
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    z-index: 40;
  }

  /* Ocultar en escritorio elementos del m√≥vil */
  .back-btn,
  #brandMark,
  .title-wrapper {
    display: none !important;
  }

  /* Centrar logo */
  #brandLogo {
    display: block !important;
    height: 56px;
    margin: 0 auto;
  }

  /* Bot√≥n galer√≠a a la derecha */
  .gallery-btn {
    position: absolute;
    left: 60px;
    top: 50%;
    transform: translateY(-50%);
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    border-radius: 10px;
    background: rgba(64, 203, 203, .10);
    border: 2px solid var(--brand);
    color: var(--brand);
    font-weight: 700;
    font-size: 14px;
    line-height: 1;
    text-decoration: none;
    transition: all .25s ease;
  }

  .gallery-btn:hover {
    background: rgba(64, 203, 203, .18);
  }

  /* 1Ô∏è‚É£ FABs: mostrar solo audio, ocultar AR */
  .fab-row {
    display: flex !important;
    justify-content: flex-start;
    gap: 12px;
    left: 36px;
    bottom: 36px;
    width: auto;
  }

  .fab-row .ar-fab,
  .ar-fab {
    display: none !important;
  }

  /* Ocultamos la flecha de volver */
  .back-btn {
    display: none !important;
  }

  /* Logo centrado perfectamente */
  #brandLogo {
    display: block;
    height: 42px;
    margin: 0 auto;
  }

  #brandLogo:hover {
    opacity: 1;
  }

  #brandMark,
  #pieceTitle {
    display: none !important;
  }



  /* Bot√≥n info oculto, galer√≠a visible */
  #infoBtn {
    display: none !important;
  }

  .gallery-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    min-width: 130px;
    height: 46px;
    padding: 0 14px;
    box-sizing: border-box;
    border: 1px solid rgba(64, 203, 203, 0.25);
    border-radius: 12px;
    background: rgba(64, 203, 203, .10);
    color: var(--brand);
    font-weight: 700;
    font-size: 14px;
    line-height: 1;
    letter-spacing: .2px;
    cursor: pointer;
    user-select: none;
    text-decoration: none;
    transition: all .25s ease;
    box-shadow: 0 0 14px rgba(64, 203, 203, 0.2);
  }

  #topBar::before,
  #topBar::after {
    content: "";
    display: block;
    width: 160px;
    /* mismo ancho que el bot√≥n de la derecha */
    height: 1px;
    flex-shrink: 0;
  }

  .gallery-btn:hover {
    background: rgba(64, 203, 203, .16);
  }

  .gallery-btn:active {
    transform: translateY(1px);
  }

  .gallery-btn svg {
    width: 18px;
    height: 18px;
  }

  /* 4Ô∏è‚É£ Model-viewer: ajustado al panel lateral */
  /* El visor ocupa todo el alto, dejando espacio lateral para la cartela */
  model-viewer {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    right: clamp(380px, 28vw, 480px);
    /* deja hueco a la derecha */
    width: auto;
    height: 100dvh;
    /* ‚úÖ ocupa TODO el alto del viewport */
    background: transparent !important;
    border-radius: 0;
    box-shadow: none;
    z-index: 0;
    /* debajo del topbar y la cartela */
  }

  /* Cartela lateral: ocupa toda la altura */
  /* Cartela integrada en el layout (no flotante) */
  #infoSheet {
    position: fixed;
    top: var(--topbar-h, 80px);
    right: 60px;
    bottom: 60px;
    width: 400px;
    border-radius: 20px;
    background: rgba(15, 17, 21, 0.88);
    backdrop-filter: blur(16px) saturate(160%);
    -webkit-backdrop-filter: blur(16px) saturate(160%);
    border: 1px solid rgba(255, 255, 255, 0.06);
    box-shadow: 0 18px 36px rgba(0, 0, 0, 0.45);
    color: var(--text);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* Contenido interno: scrolla dentro del panel */
  .info-sheet__content {
    flex: 1;
    overflow-y: auto;
    padding: 40px 42px 48px;
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, .15) transparent;
  }

  /* 5Ô∏è‚É£ Posters (GLB/SPLAT) */
  .glb-poster,
  .splat-poster {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    border-radius: inherit;
    z-index: 5;
    opacity: 1;
    transition: opacity 0.9s ease, filter 0.9s ease, transform 0.9s ease;
  }

  .glb-poster.fade-out,
  .splat-poster.fade-out {
    opacity: 0;
    filter: blur(14px) brightness(0.8);
    transform: scale(1.03);
  }

  /* 6Ô∏è‚É£ Tipograf√≠a de cartela */
  #infoTitle {
    font-family: "Poppins", system-ui, sans-serif;
    font-weight: 600;
    font-size: clamp(22px, 1.8vw, 30px);
    text-transform: uppercase;
    letter-spacing: 0.03em;
    margin-bottom: 0.8em;
    color: #f5f6f8;
  }

  .info-meta {
    font-size: 14px;
    line-height: 1.5;
    color: #aaa;
    margin-bottom: 1.6em;
  }

  .info-desc {
    font-size: 15px;
    color: #e3e3e3;
    line-height: 1.6;
  }

  .info-extra {
    display: grid;
    row-gap: 10px;
    margin-top: 1.8em;
    font-size: 14px;
    color: #dcdcdc;
  }

  .info-extra strong {
    color: #fff;
    font-weight: 500;
  }

  /* 7Ô∏è‚É£ Fondo con vignette elegante */
  body::before,
  body::after {
    content: "";
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
  }

  body::before {
    background:
      radial-gradient(900px 700px at 70% 40%, rgba(255, 200, 150, .08), transparent 80%),
      radial-gradient(900px 700px at 30% 70%, rgba(80, 130, 255, .07), transparent 80%);
    opacity: .4;
  }

  body::after {
    background: radial-gradient(1400px 900px at 50% -10%, transparent 60%, rgba(0, 0, 0, .3) 100%);
  }

  /* 8Ô∏è‚É£ Ocultar elementos m√≥viles innecesarios */
  .home-btn,
  #brandMark {
    display: none !important;
  }



  /* ===============================
     NUEVO LAYOUT DE ESCRITORIO
     =============================== */

  /* Contenedor general: visor + cartela */
  main.desktop-layout {
    display: flex;
    flex-direction: row;
    height: calc(100dvh - 56px);
    margin-top: 56px;
    /* deja hueco para el topbar */
    box-sizing: border-box;
    gap: 20px;
    /* espacio entre visor y cartela */
    padding: 0 20px 20px;
  }

  /* Visor (GLB o SPLAT) */
  model-viewer,
  iframe#splat {
    flex: 0 0 70%;
    height: 100%;
    background: #0f1115;
    border-radius: 18px;
    overflow: hidden;
    display: block;
  }

  /* Ocultar drag y bot√≥n de cerrar */
  .info-sheet__drag,
  .info-sheet__close {
    display: none !important;
  }

  /*****************************************************
 * üñ•Ô∏è CONTENEDOR DEL VISOR (GLB / SPLAT)
 *****************************************************/
  /* === BLOQUES SIM√âTRICOS Y CON AIRE === */
  #viewerContainer {
    position: fixed;
    top: 130px;
    /* margen superior */
    bottom: 60px;
    /* margen inferior */
    left: 50px;
    /* margen izquierdo */
    right: calc(clamp(340px, 25vw, 420px) + 190px);
    /* +20px de aire constante */
    /* 70% del espacio menos la mitad del gap */
    background: rgba(18, 20, 25, 0.85);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    box-shadow: 0 0 25px rgba(0, 0, 0, 0.4);
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }

  /* Ajusta el visor para encajar perfectamente en el marco */
  #viewerContainer iframe#splat,
  #viewerContainer model-viewer {
    position: absolute;
    inset: 0;
    /* top:0; right:0; bottom:0; left:0 */
    width: 100%;
    height: 100%;
    border: none;
    border-radius: inherit;
    /* coincide con el marco */
    background: transparent;
    object-fit: contain;
    z-index: 5;
  }

  /* ===== ESCRITORIO: ocultar bot√≥n de audio ===== */
  .audio-fab {
    display: none !important;
  }

  /*****************************************************
 * üñ•Ô∏è CARTELA EXCLUSIVA DE ESCRITORIO
 *****************************************************/

  .desktop-only {
    display: none;
  }

  @media (min-width: 1024px) {

    /* Mostrar solo en escritorio */
    .desktop-only {
      display: block;
    }

    /* Ocultar la cartela m√≥vil */
    #infoSheet {
      display: none !important;
    }

    /* Cartela lateral Solo Escritorio, tocar aqui para todo lo visual*/
    #infoPanel {
      position: fixed;
      top: 130px;
      bottom: 60px;
      right: 60px;
      width: clamp(340px, 25vw, 420px);
      /* ‚úÖ m√°s estrecha y flexible */
      background: rgba(18, 20, 25, 0.9);
      backdrop-filter: blur(24px) saturate(130%);
      -webkit-backdrop-filter: blur(24px) saturate(130%);
      border-radius: 22px;
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.45),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
      padding: 36px 40px 48px;
      /* ‚úÖ padding m√°s equilibrado */
      overflow-y: auto;
      z-index: 20;
    }
  }

  #infoPanel h2 {
    font-family: "Poppins", system-ui, sans-serif;
    font-weight: 600;
    font-size: clamp(22px, 1.7vw, 28px);
    color: #ffffff;
    margin-bottom: 0.5em;
    letter-spacing: 0.5px;
  }

  #infoPanel .info-meta {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.65);
    margin-bottom: 1.2em;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    /* ‚úÖ divisor sutil */
    padding-bottom: 0.8em;
  }

  #infoPanel .info-desc {
    font-size: 0.97rem;
    line-height: 1.65;
    color: rgba(240, 240, 240, 0.9);
    margin-bottom: 1.5em;
  }

  #infoPanel .info-details {
    border-top: 1px solid rgba(255, 255, 255, 0.08);
    margin-top: 1.5em;
    padding-top: 1em;
    display: grid;
    row-gap: 8px;
  }

  #infoPanel .info-details li {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.85);
    margin-bottom: 6px;
  }

  #infoPanel strong {
    color: #ffffff;
    font-weight: 500;
  }

  /* === Botones inferiores cartela escritorio === */
  #infoPanel .info-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 14px;
    margin-top: 1.8em;
    padding-top: 1.4em;
    border-top: 1px solid rgba(255, 255, 255, 0.08);
  }

  #infoPanel .info-actions button,
  #infoPanel .info-actions a {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 0.92rem;
    font-weight: 500;
    padding: 10px 16px;
    border-radius: 10px;
    text-decoration: none;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s ease;
  }

  #infoPanel .info-actions button svg,
  #infoPanel .info-actions a svg {
    stroke-width: 2;
  }

  #infoPanel .info-btn-audio {
    background: rgba(255, 80, 80, 0.15);
    color: #ff6d6d;
    border: 1px solid rgba(255, 80, 80, 0.25);
  }

  #infoPanel .info-btn-audio:hover {
    background: rgba(255, 80, 80, 0.25);
    transform: translateY(-2px);
  }

  #infoPanel .info-btn-visit {
    background: rgba(64, 203, 203, 0.15);
    color: #40cbcb;
    border: 1px solid rgba(64, 203, 203, 0.25);
  }

  #infoPanel .info-btn-visit:hover {
    background: rgba(64, 203, 203, 0.25);
    transform: translateY(-2px);
  }
}

.lang-btn {
  background: none;
  border: 1px solid rgba(255, 255, 255, 0.4);
  color: white;
  border-radius: 8px;
  padding: 6px 10px;
  margin-left: 10px;
  cursor: pointer;
  font-size: 14px;
  transition: background 0.2s ease;
}

.lang-btn:hover {
  background: rgba(255, 255, 255, 0.1);
}

/* === üåê Bot√≥n de cambio de idioma (Topbar) === */
.lang-toggle {
  display: flex;
  align-items: center;
  gap: 6px;
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.15);
  color: #e9eef7;
  font-weight: 600;
  font-size: 0.9rem;
  border-radius: 12px;
  padding: 6px 12px;
  cursor: pointer;
  transition: all 0.25s ease;
  backdrop-filter: blur(8px);
}

.lang-toggle:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.25);
  transform: scale(1.03);
}

.lang-toggle .flag {
  font-size: 1.1rem;
  line-height: 1;
}

.lang-toggle .lang-label {
  user-select: none;
}


/* =========================================================
   üì± MOBILE LAYOUT (‚â§1023px)
   Topbar + t√≠tulo + botones
   ========================================================= */
@media (max-width: 1023px) {

  /* --- TOPBAR general --- */
  #topBar {
    display: grid !important;
    grid-template-columns: auto 1fr auto;
    /* ‚Üê izquierda | centro | derecha ‚Üí */
    align-items: center;
    justify-content: stretch;
    height: 66px;
    padding: 0 10px;
    gap: 8px;
    position: relative;
    background: rgba(12, 16, 21, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, .06);
    z-index: 40;
  }

  #viewerContainer {
    position: relative;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    border-radius: 0;
    background: #0f1115;
    overflow: hidden;
  }

  /* --- Grupo izquierdo: bot√≥n volver --- */
  .left-group {
    display: inline-flex;
    align-items: center;
    justify-self: start;
    gap: 8px;
    margin-right: 0 !important;
    /* ‚úÖ quitamos hueco extra */
  }

  .back-btn {
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    margin-left: 8px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.12);
    color: #fff;
    text-decoration: none;
    transition: all 0.25s ease;
  }

  .back-btn:hover {
    background: rgba(255, 255, 255, 0.16);
  }

  .back-btn svg {
    width: 22px;
    height: 22px;
    stroke-width: 2;
  }


  /* --- Isotipo oculto en m√≥vil --- */
  #brandMark {
    display: none !important;
  }

  /* --- T√≠tulo (a la derecha del bot√≥n volver) --- */
  .title-wrapper {
    display: flex;
    align-items: center;
    gap: 10px;
    justify-self: start;
  }

  #pieceTitle {
    font-family: 'Poppins', serif;
    font-weight: 600;
    font-size: 17px;
    color: var(--text);
    margin: 0;
    line-height: 1.35;
    text-transform: none;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    pointer-events: none;
    padding-top: 1px;
    padding-bottom: 2px;
    max-height: calc(1.35em * 2 + 4px);
  }

  /* --- Bot√≥n ‚ÄúInformaci√≥n‚Äù (a la derechaa) --- */
  #infoBtn {
    display: inline-flex !important;
    justify-self: end;
    align-items: center;
    justify-content: center;
    height: 34px;
    padding: 0 12px;
    font-size: 13px;
    border-radius: 10px;
    min-width: auto;
  }

  /* --- Ocultar elementos de escritorio en m√≥vil --- */
  .gallery-btn {
    display: none !important;
  }

  #brandLogo {
    display: none !important;
  }

  /* --- Asegurar que las FABs se muestran --- */
  .fab-row {
    display: flex !important;
  }

  .glb-poster,
  .splat-poster {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    border-radius: inherit;
    z-index: 5;
    opacity: 1;
    transition: opacity 0.9s ease, filter 0.9s ease, transform 0.9s ease;
  }

  .glb-poster.fade-out,
  .splat-poster.fade-out {
    opacity: 0;
    filter: blur(14px) brightness(0.8);
    transform: scale(1.03);
  }

  #infoMeta small {
    display: block;
    font-size: 13px;
    color: var(--muted);
    margin-top: 2px;
  }


  /* Asegura que el visor est√© por encima del p√≥ster */
  model-viewer,
  iframe#splat {
    position: relative;
    z-index: 5;
  }

}
/* Estado cooldown (espera) */
.ar-fab.is-cooldown {
  background:
    radial-gradient(circle at 30% 30%, rgba(80, 80, 80, 0.65), rgba(40, 40, 40, 0.55)),
    linear-gradient(135deg, rgba(60, 60, 60, 0.65), rgba(30, 30, 30, 0.55));
  border-color: rgba(100, 100, 100, 0.60);
  color: rgba(255, 255, 255, 0.70);
  cursor: wait;
  pointer-events: none;
  box-shadow: none;
  transform: scale(0.98);
}
